---
import { FileText, Github, Play, MonitorPlay, Video, ExternalLink } from 'lucide-react';
import type { CollectionEntry } from 'astro:content';

interface Props {
  entry: CollectionEntry<'publications'>;
}

const { entry } = Astro.props;
const { title, authors, year, venue, links, award, cover } = entry.data;

const iconMap: Record<string, any> = {
  pdf: FileText,
  code: Github,
  demo: Play,
  slides: MonitorPlay,
  video: Video,
};

// Helper to format link label (e.g., "pdf" -> "PDF")
const formatLabel = (key: string) => {
  if (key === 'pdf') return 'PDF';
  if (key === 'github') return 'Code';
  return key.charAt(0).toUpperCase() + key.slice(1);
};
---

<div class="flex flex-col sm:flex-row gap-6 py-8 border-b border-gray-100 last:border-0 group">
  {cover && (
    <div class="shrink-0 w-full sm:w-48 h-32 sm:h-28 rounded-lg overflow-hidden border border-gray-100 bg-gray-50">
      <img src={cover.src} alt={title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
    </div>
  )}
  
  <div class="flex-grow space-y-2">
    <!-- Title -->
    <h3 class="text-lg font-semibold text-gray-900 leading-tight group-hover:text-blue-600 transition-colors">
      {links?.pdf ? <a href={links.pdf} target="_blank">{title}</a> : title}
    </h3>
    
    <!-- Authors -->
    <div class="text-gray-600 text-sm leading-relaxed">
      {authors.join(', ')}
    </div>
    
    <!-- Venue & Year -->
    <div class="flex items-center flex-wrap gap-2 text-sm text-gray-500">
      <span class="font-medium text-gray-800">{venue}</span>
      <span>¬∑</span>
      <span>{year}</span>
      {award && (
        <span class="px-2 py-0.5 rounded-full bg-amber-50 text-amber-700 text-xs font-medium border border-amber-100">
          üèÜ {award}
        </span>
      )}
    </div>
    
    <!-- Links -->
    {links && Object.keys(links).length > 0 && (
      <div class="flex flex-wrap gap-3 pt-1">
        {Object.entries(links).map(([key, url]) => {
          if (!url) return null;
          const Icon = iconMap[key] || ExternalLink;
          return (
            <a 
              href={url}
              target="_blank"
              class="inline-flex items-center gap-1.5 px-3 py-1 text-xs font-medium text-gray-600 border border-gray-200 rounded-md hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50 transition-all"
            >
              <Icon className="w-3.5 h-3.5" />
              {formatLabel(key)}
            </a>
          );
        })}
      </div>
    )}
  </div>
</div>
